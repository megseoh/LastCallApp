var lastCall={},$fullDate=new Date,$dayOfWeek=$fullDate.getDay(),$minutes=$fullDate.getMinutes(),$hours=$fullDate.getHours(),$time=60*$hours+$minutes;lastCall.init=function(){$("#location").on("submit",function(e){e.preventDefault();var t=$(".address").val();lastCall.query(t)})},lastCall.query=function(e){$.ajax({url:"http://lcboapi.com/stores",type:"GET",data:{per_page:10,geo:e},dataType:"jsonp",success:function(e){lastCall.storeClosed(e.result);var t=e.result[0].city;if(-1!==t.indexOf("-"))var a=t.slice(0,t.indexOf("-"));else var a=t;lastCall.updateTitle(a)}})},lastCall.updateTitle=function(e){$("#city-name").find("#page-title").text(e)},lastCall.storeClosed=function(e){$.each(e,function(e,t){0===$dayOfWeek&&null!==t.sunday_open&&console.log("store is open sunday sometime"),0===$dayOfWeek&&t.sunday_open<$time&&$time<t.sunday_close&&console.log("store is open sunday"),1===$dayOfWeek&&t.monday_open<$time&&$time<t.monday_close&&console.log("store is open monday"),2===$dayOfWeek&&t.tuesday_open<$time&&$time<t.tuesday_close&&console.log("store is open tuesday"),3===$dayOfWeek&&t.wednesday_open<$time&&$time<t.wednesday_close&&console.log("store is open wednesday"),4===$dayOfWeek&&t.thursday_open<$time&&$time<t.thursday_close&&console.log("store is open thursday"),5===$dayOfWeek&&t.friday_open<$time&&$time<t.friday_close&&console.log("store is open friday"),6===$dayOfWeek&&t.saturday_open<$time&&$time<t.saturday_close&&console.log("store is open saturday")}),lastCall.displayStores(e)},lastCall.displayStores=function(e){$.each(e,function(e,t){var a=$("<h2>").text(t.name),s=$("<h3>").text(t.address_line_1),l=$("<h4>").text((t.distance_in_meters/1e3).toFixed(1)+" km away");if(0===$dayOfWeek&&t.sunday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.sunday_close/60-12)+" p.m.");else if(0===$dayOfWeek)var n=$("<p>").text("Open until "+(t.sunday_close/60-12)+" p.m.");else if(1===$dayOfWeek&&t.monday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.monday_close/60-12)+" p.m.");else if(1===$dayOfWeek)var n=$("<p>").text("Open until "+(t.monday_close/60-12)+" p.m.");else if(2===$dayOfWeek&&t.tuesday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.tuesday_close/60-12)+" p.m.");else if(2===$dayOfWeek)var n=$("<p>").text("Open until "+(t.tuesday_close/60-12)+" p.m.");else if(3===$dayOfWeek&&t.wednesday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.wednesday_close/60-12)+" p.m.");else if(3===$dayOfWeek)var n=$("<p>").text("Open until "+(t.wednesday_close/60-12)+" p.m.");else if(4===$dayOfWeek&&t.thursday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.thursday_close/60-12)+" p.m.");else if(4===$dayOfWeek)var n=$("<p>").text("Open until "+(t.thursday_close/60-12)+" p.m.");else if(5===$dayOfWeek&&t.friday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.friday_close/60-12)+" p.m.");else if(5===$dayOfWeek)var n=$("<p>").text("Open until "+(t.friday_close/60-12)+" p.m.");else if(6===$dayOfWeek&&t.saturday_close-$time<60)var n=$("<p>").text("Hurry! Only open until "+(t.saturday_close/60-12)+" p.m.");else if(6===$dayOfWeek)var n=$("<p>").text("Open until "+(t.saturday_close/60-12)+" p.m.");$(".stores").append(a),$(".stores").append(s).append(l),$(".stores").append(n)})},$(function(){lastCall.init()});